"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.componentGeneratorInternal = exports.componentGenerator = void 0;
const devkit_1 = require("@nx/devkit");
const path_1 = require("path");
const utils_1 = require("./lib/utils");
async function componentGenerator(host, schema) {
    return componentGeneratorInternal(host, {
        nameAndDirectoryFormat: 'derived',
        ...schema,
    });
}
exports.componentGenerator = componentGenerator;
async function componentGeneratorInternal(host, schema) {
    const options = await (0, utils_1.normalizeOptions)(host, schema);
    createComponentFiles(host, options);
    (0, utils_1.addExportsToBarrel)(host, options);
    if (!options.skipFormat) {
        await (0, devkit_1.formatFiles)(host);
    }
}
exports.componentGeneratorInternal = componentGeneratorInternal;
function createComponentFiles(host, options) {
    (0, devkit_1.generateFiles)(host, (0, path_1.join)(__dirname, './files'), options.directory, {
        ...options,
        tmpl: '',
    });
    for (const c of host.listChanges()) {
        let deleteFile = false;
        if ((options.skipTests || options.inSourceTests) &&
            /.*spec.ts/.test(c.path)) {
            deleteFile = true;
        }
        if (deleteFile) {
            host.delete(c.path);
        }
    }
    if (options.js)
        (0, devkit_1.toJS)(host);
}
exports.default = componentGenerator;
